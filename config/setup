#!/bin/sh

apt install apache2 php libapache2-mod-php8.1 mariadb-server php-mysqli -y
echo "\n--------------------APACHE----------------------\n"
apache2 -v
echo "\n----------------------PHP-----------------------\n"
php -v
echo "\n--------------------MARIADB---------------------\n"
mariadb -V
echo "\n------------------------------------------------\n"

cp -r api /var/www
cp -r web /var/www

a2enmod rewrite
a2enmod php8.1
cp ./config/000-default.conf /etc/apache2/sites-available
systemctl stop apache2
systemctl start apache2

echo "localhost:php:$1:quiz:3306" > /home/.mysql
echo "$2" > /home/.jwt

mysql -e "
DROP USER IF EXISTS 'php'@'localhost';
CREATE USER 'php'@'localhost' IDENTIFIED BY '$1';
GRANT SELECT, UPDATE, INSERT, DELETE ON quiz.* TO 'php'@'localhost';
"

mysql < ./config/db.sql
mysql < ./config/test.sql

